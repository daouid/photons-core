

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>photons_transport &mdash; Photons 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Photons 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Available Photons Modules" href="../available_modules.html"/>
        <link rel="prev" title="photons_tile_paint" href="photons_tile_paint.html"/>
   
	<link rel="stylesheet" href="../_static/css/styles.css" type="text/css"/>


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Photons
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../lifx_script.html">LIFX script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts.html">Making a Photons Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../library.html">Using Photons as a library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../venvstarter.html">Using Venvstarter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../script_mechanism.html">The Script Mechanism</a></li>
<li class="toctree-l1"><a class="reference internal" href="../planner.html">Planner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config_file.html">Config file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../discovery.html">Device Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../finding_serials.html">Finding Serials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tile_animations.html">Tile Animations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../packets.html">Packets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../known_issues.html">Known Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">ChangeLog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../photons_app/index.html">photons_app</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binary_protocol.html">LIFX Binary protocol</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../available_modules.html">Available Photons Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="photons_colour.html">photons_colour</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_control.html">photons_control</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_core.html">photons_core</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_device_finder.html">photons_device_finder</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_messages.html">photons_messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_products.html">photons_products</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_protocol.html">photons_protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_pytest.html">photons_pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_themes.html">photons_themes</a></li>
<li class="toctree-l2"><a class="reference internal" href="photons_tile_paint.html">photons_tile_paint</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">photons_transport</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-photons_transport.targets">Target</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-photons_transport.session">Session</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-photons_transport.transports">Transports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retry-options">Retry options</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Photons</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../available_modules.html">Available Photons Modules</a> &raquo;</li>
        
      <li>photons_transport</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/modules/photons_transport.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="photons-transport">
<span id="id1"></span><h1>photons_transport<a class="headerlink" href="#photons-transport" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-photons_transport"></span><p>This module is responsible for determining how to get bytes to and from devices.</p>
<p>It contains targets which know how to communicate with devices in a particular
way. You use these targets to create one or more sessions, which each have one
or more connections to your devices that it uses to send a receive messages.</p>
<div class="section" id="module-photons_transport.targets">
<span id="target"></span><h2>Target<a class="headerlink" href="#module-photons_transport.targets" title="Permalink to this headline">¶</a></h2>
<p>A target encapsulates the logic for finding devices over a particular medium and
then talking to them over that medium.</p>
<dl class="class">
<dt id="photons_transport.targets.LanTarget">
<em class="property">class </em><code class="descclassname">photons_transport.targets.</code><code class="descname">LanTarget</code><span class="sig-paren">(</span><em>default_broadcast</em>, <em>description</em>, <em>discovery_options</em>, <em>final_future</em>, <em>protocol_register</em><span class="sig-paren">)</span><a class="headerlink" href="#photons_transport.targets.LanTarget" title="Permalink to this definition">¶</a></dt>
<dd><p>Knows how to talk to a device over the local network. It’s one configuration
option is default_broadcast which says what address to broadcast discovery
if broadcast is given to run_with calls as True.</p>
<dl class="attribute">
<dt id="photons_transport.targets.LanTarget.session_kls">
<code class="descname">session_kls</code><a class="headerlink" href="#photons_transport.targets.LanTarget.session_kls" title="Permalink to this definition">¶</a></dt>
<dd><p>alias of <code class="xref py py-class docutils literal"><span class="pre">NetworkSession</span></code></p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="photons_transport.targets.MemoryTarget">
<em class="property">class </em><code class="descclassname">photons_transport.targets.</code><code class="descname">MemoryTarget</code><span class="sig-paren">(</span><em>default_broadcast</em>, <em>description</em>, <em>devices</em>, <em>final_future</em>, <em>protocol_register</em><span class="sig-paren">)</span><a class="headerlink" href="#photons_transport.targets.MemoryTarget" title="Permalink to this definition">¶</a></dt>
<dd><p>Knows how to talk to fake devices as if they were on the network.</p>
</dd></dl>

</div>
<div class="section" id="module-photons_transport.session">
<span id="session"></span><h2>Session<a class="headerlink" href="#module-photons_transport.session" title="Permalink to this headline">¶</a></h2>
<p>A session object holds the discovery information per device and knows how to
to talk to the device.</p>
<dl class="class">
<dt id="photons_transport.session.network.NetworkSession">
<em class="property">class </em><code class="descclassname">photons_transport.session.network.</code><code class="descname">NetworkSession</code><span class="sig-paren">(</span><em>target</em><span class="sig-paren">)</span><a class="headerlink" href="#photons_transport.session.network.NetworkSession" title="Permalink to this definition">¶</a></dt>
<dd><p>Knows how to discover by broadcasting GetService. It then knows per packet
which service to use for sending messages.</p>
</dd></dl>

</div>
<div class="section" id="module-photons_transport.transports">
<span id="transports"></span><h2>Transports<a class="headerlink" href="#module-photons_transport.transports" title="Permalink to this headline">¶</a></h2>
<p>A transport is an object representing a single connection to a device.</p>
<dl class="class">
<dt id="photons_transport.transports.udp.UDP">
<em class="property">class </em><code class="descclassname">photons_transport.transports.udp.</code><code class="descname">UDP</code><span class="sig-paren">(</span><em>session</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#photons_transport.transports.udp.UDP" title="Permalink to this definition">¶</a></dt>
<dd><p>Knows how to send and receive over udp</p>
</dd></dl>

<dl class="class">
<dt id="photons_transport.transports.memory.Memory">
<em class="property">class </em><code class="descclassname">photons_transport.transports.memory.</code><code class="descname">Memory</code><span class="sig-paren">(</span><em>session</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#photons_transport.transports.memory.Memory" title="Permalink to this definition">¶</a></dt>
<dd><p>Knows how to send and receive messages with an in memory Fake device</p>
</dd></dl>

</div>
<div class="section" id="retry-options">
<h2>Retry options<a class="headerlink" href="#retry-options" title="Permalink to this headline">¶</a></h2>
<p>This module also provides a <code class="docutils literal"><span class="pre">RetryOptions</span></code> and <code class="docutils literal"><span class="pre">RetryIterator</span></code> for working
with retry logic.</p>
<dl class="class">
<dt id="photons_transport.RetryOptions">
<em class="property">class </em><code class="descclassname">photons_transport.</code><code class="descname">RetryOptions</code><span class="sig-paren">(</span><em>timeouts=None</em><span class="sig-paren">)</span><a class="headerlink" href="#photons_transport.RetryOptions" title="Permalink to this definition">¶</a></dt>
<dd><p>Options for working out how long to wait for replies to our messages</p>
<dl class="docutils">
<dt>finish_multi_gap</dt>
<dd>When a packet has an unbound number of results or acks, this number is
used to schedule the next check to see if we should finish this result</dd>
<dt>gap_between_results</dt>
<dd><p class="first">When a packet has an unbound number of results we uses this number to
determine when we have enough results. Essentially the answer is yes if
it’s been this long since the last result</p>
<p class="last">It is a good idea to make this number less than finish_multi_gap so that
when we check after a finish_multi_gap amount of time in the future we
can mark the result as done</p>
</dd>
<dt>gap_between_ack_and_res</dt>
<dd><p class="first">When a packet has a received an acknowledgment but not a result, this
number is used to determine if we should wait for the result or send
the request again.</p>
<p class="last">i.e. only send a retry if it’s been longer than this time since the
acknowledgement</p>
</dd>
<dt>next_check_after_wait_for_result</dt>
<dd>If we should wait for the next reply instead of sending a retry, then
we use this time to schedule the next check.</dd>
<dt>timeouts</dt>
<dd><p class="first">A list of (step, end) tuples that is used to determine the retry backoff.</p>
<p>This is used by the <code class="docutils literal"><span class="pre">next_time</span></code> property on this object.</p>
<p>Essentially, starting with the first step, increase by step until you
reach end and then use the next tuple to determine backoff from there.</p>
<p class="last">So <code class="docutils literal"><span class="pre">[(0.1,</span> <span class="pre">0.1),</span> <span class="pre">(0.2,</span> <span class="pre">0.5),</span> <span class="pre">(0.5,</span> <span class="pre">3)]</span></code> would go
<code class="docutils literal"><span class="pre">0.1,</span> <span class="pre">0.3,</span> <span class="pre">0.5,</span> <span class="pre">1,</span> <span class="pre">1.5,</span> <span class="pre">2,</span> <span class="pre">2.5,</span> <span class="pre">3,</span> <span class="pre">3,</span> <span class="pre">3,</span> <span class="pre">...</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="photons_transport.RetryIterator">
<em class="property">class </em><code class="descclassname">photons_transport.</code><code class="descname">RetryIterator</code><span class="sig-paren">(</span><em>end_at</em>, <em>get_next_time</em>, <em>min_wait=0.1</em>, <em>get_now=&lt;built-in function time&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#photons_transport.RetryIterator" title="Permalink to this definition">¶</a></dt>
<dd><p>An async generator to help with retries.</p>
<p>usage is like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="n">retries</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">get_next_time</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">retries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">retries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">retries</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">end_at</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">10</span>
<span class="n">min_wait</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="n">async</span> <span class="k">for</span> <span class="n">time_left</span><span class="p">,</span> <span class="n">time_till_next_retry</span> <span class="ow">in</span> <span class="n">RetryIterator</span><span class="p">(</span><span class="n">end_at</span><span class="p">,</span> <span class="n">get_next_time</span><span class="p">):</span>
    <span class="c1"># Do something that will take up to time_till_next_retry seconds</span>
</pre></div>
</div>
<p>The recommended way of creating one of these is via a RetryOptions object:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">async</span> <span class="k">for</span> <span class="n">time_left</span><span class="p">,</span> <span class="n">time_till_next_retry</span> <span class="ow">in</span> <span class="n">RetryOptions</span><span class="p">()</span><span class="o">.</span><span class="n">iterator</span><span class="p">(</span><span class="n">end_after</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="c1"># Do something that will take up to time_till_next_retry seconds</span>
</pre></div>
</div>
<p>The async generator will use get_next_time to determine the minimum amount of time to wait before
letting the body of the loop run again. So let’s say time_till_next_retry is 3 seconds and the
body takes only 1 second, then we will wait 2 seconds before letting the body run again.</p>
<p>You may also provided min_wait (defaults to 0.1). We will stop iteration if the time left till
we should end is less than this amount. We will also use get_next_time() again if the time between
now and the next time is less than min_wait</p>
</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="photons_tile_paint.html" class="btn btn-neutral" title="photons_tile_paint" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Stephen Moore.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>